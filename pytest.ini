[pytest]
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

markers =
    celery: marks tests that require celery
    integration: marks integration tests
    unit: marks unit tests
    slow: marks tests that take longer to run
    security: marks security-related tests
    e2e: marks end-to-end tests that require a full running API server (localhost:8000)

env =
    ENVIRONMENT=test
    LOG_LEVEL=ERROR
    DATABASE_URL=postgresql://postgres:postgres@localhost:5432/robosystems_test
    TEST_DATABASE_URL=postgresql://postgres:postgres@localhost:5432/robosystems_test
    POSTGRES_PASSWORD=postgres
    ANTHROPIC_API_KEY=test-anthropic-key
    ANTHROPIC_MODEL=claude-sonnet-4-20250514
    AWS_ENDPOINT_URL=http://localhost:4566
    AWS_REGION=us-east-1
    AWS_S3_ACCESS_KEY_ID=test
    AWS_S3_BUCKET=robosystems-local
    AWS_S3_SECRET_ACCESS_KEY=test
    INTUIT_CLIENT_ID=test-intuit-client-id
    INTUIT_CLIENT_SECRET=test-intuit-secret
    INTUIT_ENVIRONMENT=sandbox
    INTUIT_REDIRECT_URI=http://localhost:8000/auth/callback
    JWT_SECRET_KEY=test-jwt-secret-key-12345678901234567890abcdef
    CONNECTION_CREDENTIALS_KEY=test-connection-credentials-key-12345678901234567890abcdef
    GRAPH_API_URL=http://localhost:8001
    GRAPH_BACKUP_ENCRYPTION_KEY=test-encryption-key-dev
    KUZU_DATABASE_PATH=./data/kuzu-dbs
    KUZU_MAX_DATABASES_PER_NODE=50
    OPENFIGI_API_KEY=test-openfigi-key
    SEC_GOV_USER_AGENT=test-user-agent test@example.com
    VALKEY_URL=redis://localhost:6379
    VALKEY_AUTH_TOKEN=valkey
    ADMISSION_MEMORY_THRESHOLD=99.0
    ADMISSION_CPU_THRESHOLD=99.0
    ADMISSION_QUEUE_THRESHOLD=0.95
    QUERY_QUEUE_MAX_SIZE=10000
    QUERY_QUEUE_MAX_CONCURRENT=100
    QUERY_QUEUE_MAX_PER_USER=100
    QUERY_QUEUE_TIMEOUT=600
    GRAPH_HTTP_TIMEOUT=60
    GRAPH_QUERY_TIMEOUT=60
    GRAPH_MAX_QUERY_LENGTH=100000
    USER_REGISTRATION_ENABLED=true
    RATE_LIMIT_ENABLED=false
    SSE_ENABLED=true
    OTEL_ENABLED=false
    LOAD_SHEDDING_ENABLED=true
    CSP_TRUSTED_TYPES_ENABLED=false
    MCP_AUTO_LIMIT_ENABLED=true
    CONNECTION_SEC_ENABLED=true
    CONNECTION_QUICKBOOKS_ENABLED=true
    CONNECTION_PLAID_ENABLED=true
    BILLING_ENABLED=true
    BILLING_PREMIUM_PLANS_ENABLED=true
    SECURITY_AUDIT_ENABLED=true
    GRAPH_CIRCUIT_BREAKERS_ENABLED=true
    GRAPH_REDIS_CACHE_ENABLED=true
    GRAPH_RETRY_LOGIC_ENABLED=true
    GRAPH_HEALTH_CHECKS_ENABLED=true
    SUBGRAPH_CREATION_ENABLED=true
    BACKUP_CREATION_ENABLED=true
    AGENT_POST_ENABLED=true
    EMAIL_VERIFICATION_ENABLED=true
    CAPTCHA_ENABLED=false

console_output_style = progress
log_cli = true
log_cli_level = ERROR
log_cli_format = %(asctime)s [%(levelname)8s] %(message)s (%(filename)s:%(lineno)s)
log_cli_date_format = %Y-%m-%d %H:%M:%S

addopts = -xvs --no-header --ignore=robosystems/arelle/EDGAR --ignore=robosystems/arelle -m "not e2e"

asyncio_mode = auto
asyncio_default_fixture_loop_scope = function

filterwarnings =
    ignore::DeprecationWarning
    ignore::UserWarning
