# Kuzu Deployment Configuration
# This file defines all Kuzu writer configurations for both environments
# Including complete tier specifications (instance types, memory, performance settings)

production:
  writers:
    - name: standard
      description: Standard tier for most customers
      stack_suffix: Standard
      tier: standard
      max_subgraphs: 0 # Standard tier does not support subgraphs
      storage_limit_gb: 500 # 500 GB storage limit
      monthly_credits: 10000 # 10K AI credits per month
      rate_limit_multiplier: 1.0 # Base rate limits
      instance:
        type: r7g.large
        databases_per_instance: 10
        max_memory_mb: 14336 # 14GB for r7g.large (16GB total - 2GB OS)
        memory_per_db_mb: 2048 # 2GB per database (intentional oversubscription: 10 DBs Ã— 2GB = 20GB on 14GB instance)
        chunk_size: 1000
        query_timeout: 30
        max_query_length: 10000
        ingestion_batch_size: 1000
        connection_pool_size: 10
      scaling:
        min: 1
        max: 10
      deployment:
        enable_var: STANDARD_ENABLED_PROD
        enabled_default: true
        always_enabled: true # Standard tier must always be available

    - name: enterprise
      description: Enterprise tier with isolated resources
      stack_suffix: Enterprise
      tier: enterprise
      max_subgraphs: 10 # Enterprise tier supports up to 10 subgraphs
      storage_limit_gb: 2000 # 2 TB storage limit
      monthly_credits: 50000 # 50K AI credits per month
      rate_limit_multiplier: 2.0 # 2x rate limits
      instance:
        type: r7g.large
        databases_per_instance: 1
        max_memory_mb: 14336 # 14GB for r7g.large (16GB total - 2GB OS)
        memory_per_db_mb: 14336 # Full allocation
        chunk_size: 5000
        query_timeout: 120
        max_query_length: 50000
        ingestion_batch_size: 5000
        connection_pool_size: 50
      scaling:
        min: 0
        max: 5
      deployment:
        enable_var: ENTERPRISE_ENABLED_PROD
        enabled_default: false

    - name: premium
      description: Premium tier with maximum performance
      stack_suffix: Premium
      tier: premium
      max_subgraphs: null # Premium tier supports unlimited subgraphs
      storage_limit_gb: 10000 # 10 TB storage limit
      monthly_credits: 200000 # 200K AI credits per month
      rate_limit_multiplier: 5.0 # 5x rate limits
      instance:
        type: r7g.xlarge
        databases_per_instance: 1
        max_memory_mb: 28672 # 28GB for r7g.xlarge
        memory_per_db_mb: 28672 # Full allocation
        chunk_size: 10000
        query_timeout: 300
        max_query_length: 100000
        ingestion_batch_size: 10000
        connection_pool_size: 100
      scaling:
        min: 0
        max: 3
      deployment:
        enable_var: PREMIUM_ENABLED_PROD
        enabled_default: false

    - name: shared-master
      description: Master node for shared repositories (SEC, industry, economic)
      stack_suffix: SharedMaster
      tier: shared
      shared_repositories: "sec" # Start with just SEC, can add "sec,industry,economic" later
      instance:
        type: r7g.xlarge
        databases_per_instance: 10
        max_memory_mb: 28672 # 28GB for r7g.xlarge (32GB total - 4GB OS)
        memory_per_db_mb: 0 # Shared pool - no per-DB limit
        chunk_size: 10000
        query_timeout: 300
        max_query_length: 100000
        ingestion_batch_size: 10000
        connection_pool_size: 100
      scaling:
        min: 1
        max: 1
      deployment:
        enable_var: SHARED_MASTER_ENABLED_PROD
        enabled_default: true
        always_enabled: true # Shared master is required for SEC access

  replicas:
    - name: shared-replicas
      description: Read replicas for shared repositories
      stack_suffix: SharedReplicas
      shared_repositories: "sec,industry,economic"
      instance:
        type: r7g.large
      scaling:
        min: 2
        max: 20
        desired: 2
      deployment:
        enable_var: SHARED_REPLICA_ENABLED_PROD
        enabled_default: true

staging:
  writers:
    - name: standard
      description: Standard tier for staging
      stack_suffix: Standard
      tier: standard
      max_subgraphs: 0 # Standard tier does not support subgraphs
      storage_limit_gb: 100 # 100 GB storage limit (reduced for staging)
      monthly_credits: 5000 # 5K AI credits per month (reduced for staging)
      rate_limit_multiplier: 1.0 # Base rate limits
      instance:
        type: r7g.medium
        databases_per_instance: 10
        max_memory_mb: 7168 # 7GB for r7g.medium (8GB total - 1GB OS)
        memory_per_db_mb: 716 # ~700MB per database
        chunk_size: 750
        query_timeout: 30
        max_query_length: 10000
        ingestion_batch_size: 750
        connection_pool_size: 10
      scaling:
        min: 1
        max: 5
      deployment:
        enable_var: STANDARD_ENABLED_STAGING
        enabled_default: true
        always_enabled: true # Standard tier must always be available

    - name: shared-master
      description: Master node for shared repositories in staging
      stack_suffix: SharedMaster
      tier: shared
      shared_repositories: "sec" # Start with just SEC, can add "sec,industry,economic" later
      instance:
        type: r7g.medium
        databases_per_instance: 10
        max_memory_mb: 7168 # 7GB for r7g.medium
        memory_per_db_mb: 0 # Shared pool - no per-DB limit
        chunk_size: 2500
        query_timeout: 120
        max_query_length: 50000
        ingestion_batch_size: 3500
        connection_pool_size: 35
      scaling:
        min: 1
        max: 1
      deployment:
        enable_var: SHARED_MASTER_ENABLED_STAGING
        enabled_default: true
        always_enabled: true # Shared master is required for SEC access

  replicas:
    - name: shared-replicas
      description: Read replicas for shared repositories in staging
      stack_suffix: SharedReplicas
      shared_repositories: "sec,industry,economic"
      instance:
        type: r7g.medium
      scaling:
        min: 1
        max: 2
        desired: 1
      deployment:
        enable_var: SHARED_REPLICA_ENABLED_STAGING
        enabled_default: false
