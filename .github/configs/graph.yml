# Graph Database Deployment Configuration
# This file defines all graph database writer configurations for both environments
#
# ARCHITECTURE: LadybugDB-only graph tier system
# - All tiers use LadybugDB backend (embedded graph database)
# - Tiers differentiated by: instance isolation, subgraph support, resource allocation
# - Platform metadata stored in PostgreSQL, graphs contain only business data
# - Supports "MotherDuck for Graphs" pattern: DuckDB staging â†’ LadybugDB materialization
#
# TIER PHILOSOPHY:
# - Standard: Multi-tenant, single database, cost-efficient entry
# - Professional: Dedicated instance, subgraphs for organization, team collaboration
# - Enterprise: Large dedicated instance, unlimited subgraphs, advanced scale
# - Shared: Public data repositories (SEC, industry, economic) - separate infrastructure

production:
  writers:
    # =========================================================================
    # LADYBUGDB STANDARD TIER - Multi-tenant
    # =========================================================================
    - name: ladybug-standard
      description: Multi-tenant LadybugDB tier for cost-efficient entry (scalable instance size)
      backend: ladybug
      stack_suffix: LadybugStandard
      tier: ladybug-standard

      # Subgraph configuration
      max_subgraphs: 0 # Single database only, no subgraph support

      # Resource limits
      api_rate_multiplier: 1.0 # Base rate limits (1x)

      # Copy operation limits
      copy_operations:
        max_file_size_gb: 1.0 # Maximum file size per copy operation
        timeout_seconds: 300 # 5 minute timeout for copy operations
        concurrent_operations: 1 # One copy operation at a time
        max_files_per_operation: 100 # Maximum files per batch copy
        daily_copy_operations: 10 # Daily copy operation limit

      # Backup limits
      backup_limits:
        max_backup_size_gb: 10 # Maximum backup size for standard tier
        backup_retention_days: 7 # Backup retention period
        max_backups_per_day: 2 # Daily backup limit

      # Instance configuration
      instance:
        type: r7g.large # 16GB RAM, 2 vCPUs, ARM64
        databases_per_instance: 10 # Multi-tenant: 10 customer databases per instance

        # Memory configuration
        max_memory_mb: 14336 # 14GB available (16GB - 2GB OS overhead)
        memory_per_db_mb: 2048 # 2GB per database (intentional oversubscription for cost efficiency)

        # LadybugDB-specific performance settings
        chunk_size: 1000 # Batch operation chunk size
        query_timeout: 30 # Query timeout in seconds
        max_query_length: 10000 # Maximum query size in characters
        ingestion_batch_size: 1000 # Batch size for data ingestion
        connection_pool_size: 10 # Max concurrent connections per database

      # Deployment configuration
      deployment:
        enable_var: LBUG_STANDARD_ENABLED_PROD
        enabled_default: true
        always_enabled: true # LadybugDB standard tier is the foundation - always available

    # =========================================================================
    # LADYBUGDB LARGE TIER - Dedicated r7g.large
    # =========================================================================
    - name: ladybug-large
      description: Dedicated r7g.large with subgraph support (10 subgraphs)
      backend: ladybug
      stack_suffix: LadybugLarge
      tier: ladybug-large

      # Subgraph configuration
      max_subgraphs: 10 # Support up to 10 subgraphs (1 parent + 10 children = 11 databases total)

      # Resource limits
      api_rate_multiplier: 2.5 # 2.5x rate limits for team usage

      # Copy operation limits
      copy_operations:
        max_file_size_gb: 5.0 # Larger files for professional workloads
        timeout_seconds: 1800 # 30 minute timeout for large operations
        concurrent_operations: 3 # Support concurrent operations for team
        max_files_per_operation: 1000 # Higher batch limits
        daily_copy_operations: 50 # More operations for active development

      # Backup limits
      backup_limits:
        max_backup_size_gb: 50 # Larger backup capacity for professional workloads
        backup_retention_days: 30 # Extended retention for team collaboration
        max_backups_per_day: 10 # More frequent backups for active development

      # Instance configuration
      instance:
        type: r7g.large # 16GB RAM, 2 vCPUs, ARM64 - dedicated per customer
        databases_per_instance: 1 # One parent database per instance (subgraphs on same instance)

        # Memory configuration
        max_memory_mb: 14336 # 14GB total available for parent + subgraphs
        memory_per_db_mb: 1300 # ~1.3GB average per database (14GB / 11 databases)
        # Note: Memory is dynamically shared among parent and subgraphs

        # LadybugDB-specific performance settings
        chunk_size: 1500 # Larger chunks for better performance
        query_timeout: 60 # 60 second timeout for complex queries
        max_query_length: 25000 # Support more complex queries
        ingestion_batch_size: 2500 # Faster ingestion with dedicated resources
        connection_pool_size: 25 # Higher concurrency for team usage

      # Deployment configuration
      deployment:
        enable_var: LBUG_LARGE_ENABLED_PROD
        enabled_default: false

    # =========================================================================
    # LADYBUGDB XLARGE TIER - Dedicated r7g.xlarge
    # =========================================================================
    - name: ladybug-xlarge
      description: Dedicated r7g.xlarge with maximum subgraph support (25 subgraphs)
      backend: ladybug
      stack_suffix: LadybugXlarge
      tier: ladybug-xlarge

      # Subgraph configuration
      max_subgraphs: 25 # Practical limit of 25 subgraphs (marketed as "unlimited")
      # Note: 1 parent + 25 subgraphs = 26 databases total on xlarge instance

      # Resource limits
      api_rate_multiplier: 5.0 # 5x rate limits for enterprise usage

      # Copy operation limits
      copy_operations:
        max_file_size_gb: 10.0 # Maximum file size for enterprise workloads
        timeout_seconds: 3600 # 1 hour timeout for massive operations
        concurrent_operations: 5 # Maximum concurrency for enterprise
        max_files_per_operation: 10000 # Very high batch limits
        daily_copy_operations: -1 # Unlimited for enterprise (no daily limit)

      # Backup limits
      backup_limits:
        max_backup_size_gb: 100 # Maximum backup capacity for enterprise
        backup_retention_days: 90 # Extended retention for compliance
        max_backups_per_day: -1 # Unlimited backups for enterprise (no daily limit)

      # Instance configuration
      instance:
        type: r7g.xlarge # 32GB RAM, 4 vCPUs, ARM64 - large dedicated per customer
        databases_per_instance: 1 # One parent database per instance (many subgraphs on same instance)

        # Memory configuration
        max_memory_mb: 30720 # 30GB available (32GB - 2GB OS overhead)
        memory_per_db_mb: 1180 # ~1.2GB average per database (30GB / 26 databases)
        # Note: Memory is dynamically shared, some databases can use more when needed

        # LadybugDB-specific performance settings
        chunk_size: 2000 # Maximum chunk size for best performance
        query_timeout: 120 # 2 minute timeout for complex analytical queries
        max_query_length: 50000 # Support very complex queries
        ingestion_batch_size: 5000 # Fast bulk ingestion
        connection_pool_size: 50 # High concurrency for enterprise applications

      # Deployment configuration
      deployment:
        enable_var: LBUG_XLARGE_ENABLED_PROD
        enabled_default: false

    # =========================================================================
    # LADYBUGDB SHARED TIER - Public Data Repositories
    # =========================================================================
    - name: ladybug-shared
      description: Shared public data repositories (SEC, industry, economic) - LadybugDB backend
      backend: ladybug
      stack_suffix: LadybugShared
      tier: ladybug-shared

      # Repository configuration
      shared_repositories: "sec,industry,economic" # Comma-separated list of public repositories
      max_subgraphs: null # N/A - repositories don't use subgraphs

      # Resource limits
      api_rate_multiplier: null # Separate rate limiting for public access

      # Copy operation limits (for platform data loading)
      copy_operations:
        max_file_size_gb: 10.0 # Large files for bulk data loading
        timeout_seconds: 3600 # 1 hour for massive SEC filings
        concurrent_operations: 3 # Moderate concurrency for platform operations
        max_files_per_operation: 10000 # High batch limits for quarterly filings
        daily_copy_operations: -1 # Unlimited for platform operations

      # Backup limits
      backup_limits:
        max_backup_size_gb: 100 # Large capacity for public data repositories
        backup_retention_days: 90 # Extended retention for public data
        max_backups_per_day: 5 # Moderate backup frequency

      # Instance configuration
      instance:
        type: r7g.large # 16GB RAM per repository instance
        databases_per_instance: 1 # One repository per instance (SEC gets dedicated instance)
        # Note: Major repositories like SEC get dedicated instances for performance

        # Memory configuration
        max_memory_mb: 14336 # 14GB available for repository
        memory_per_db_mb: 14336 # Full instance memory for single repository

        # LadybugDB-specific performance settings (optimized for read-heavy analytical queries)
        chunk_size: 2500 # Large chunks for bulk operations
        query_timeout: 300 # 5 minute timeout for complex analytical queries on public data
        max_query_length: 100000 # Very large queries supported for analytics
        ingestion_batch_size: 10000 # Fast bulk loading for public data updates
        connection_pool_size: 100 # High concurrency - many users accessing public data

      # Deployment configuration
      deployment:
        enable_var: LBUG_SHARED_ENABLED_PROD
        enabled_default: true

    # =========================================================================
    # NEO4J COMMUNITY LARGE TIER - Optional (DISABLED)
    # =========================================================================
    - name: neo4j-community-large
      description: Neo4j Community Edition on r7g.large (OPTIONAL - disabled by default)
      backend: neo4j
      stack_suffix: Neo4jCommunityLarge
      tier: neo4j-community-large

      # Subgraph configuration
      max_subgraphs: 0 # Neo4j Community restricted to 1 database (default graph only)

      # Resource limits
      api_rate_multiplier: 3.0 # 3x rate limits

      # Copy operation limits
      copy_operations:
        max_file_size_gb: 5.0
        timeout_seconds: 1200
        concurrent_operations: 3
        max_files_per_operation: 300
        daily_copy_operations: 50

      # Backup limits
      backup_limits:
        max_backup_size_gb: 200
        backup_retention_days: 30
        max_backups_per_day: 10

      # Instance configuration
      instance:
        type: r7g.large # 16GB RAM, dedicated per customer
        databases_per_instance: 1 # One Neo4j instance per customer

        # Neo4j-specific settings
        neo4j_version: "5.15.0"
        neo4j_edition: "community"
        neo4j_heap_size_mb: 8192 # 8GB heap for Neo4j
        neo4j_page_cache_mb: 4096 # 4GB page cache
        query_timeout: 90 # 90 second timeout
        max_query_length: 50000
        ingestion_batch_size: 5000
        connection_pool_size: 50

      # Deployment configuration
      deployment:
        enable_var: NEO4J_COMMUNITY_LARGE_ENABLED_PROD
        enabled_default: false # DISABLED - Do not deploy unless explicitly enabled
        optional: true # Mark as optional tier

    # =========================================================================
    # NEO4J ENTERPRISE XLARGE TIER - Optional (DISABLED)
    # =========================================================================
    - name: neo4j-enterprise-xlarge
      description: Neo4j Enterprise Edition on r7g.xlarge (OPTIONAL - disabled by default)
      backend: neo4j
      stack_suffix: Neo4jEnterpriseXlarge
      tier: neo4j-enterprise-xlarge

      # Subgraph configuration
      max_subgraphs: 25 # Neo4j Enterprise supports more databases

      # Resource limits
      api_rate_multiplier: 6.0 # 6x rate limits

      # Copy operation limits
      copy_operations:
        max_file_size_gb: 10.0
        timeout_seconds: 3600
        concurrent_operations: 10
        max_files_per_operation: 1000
        daily_copy_operations: 200

      # Backup limits
      backup_limits:
        max_backup_size_gb: 1000
        backup_retention_days: 90
        max_backups_per_day: 20

      # Instance configuration
      instance:
        type: r7g.xlarge # 32GB RAM, large dedicated per customer
        databases_per_instance: 1 # One Neo4j Enterprise instance per customer

        # Neo4j-specific settings
        neo4j_version: "5.15.0"
        neo4j_edition: "enterprise"
        neo4j_heap_size_mb: 16384 # 16GB heap for Neo4j
        neo4j_page_cache_mb: 12288 # 12GB page cache
        neo4j_clustering: true # Enterprise supports clustering
        query_timeout: 180 # 3 minute timeout
        max_query_length: 100000
        ingestion_batch_size: 10000
        connection_pool_size: 100

      # Deployment configuration
      deployment:
        enable_var: NEO4J_ENTERPRISE_XLARGE_ENABLED_PROD
        enabled_default: false # DISABLED - Do not deploy unless explicitly enabled
        optional: true # Mark as optional tier

# =============================================================================
# STAGING ENVIRONMENT
# =============================================================================
staging:
  writers:
    # =========================================================================
    # LADYBUGDB STANDARD TIER - Staging (reduced resources)
    # =========================================================================
    - name: ladybug-standard
      description: Multi-tenant LadybugDB tier for staging (reduced resources)
      backend: ladybug
      stack_suffix: LadybugStandard
      tier: ladybug-standard

      max_subgraphs: 0
      api_rate_multiplier: 1.0

      # Copy operation limits
      copy_operations:
        max_file_size_gb: 1.0
        timeout_seconds: 300
        concurrent_operations: 1
        max_files_per_operation: 100
        daily_copy_operations: 10

      # Backup limits
      backup_limits:
        max_backup_size_gb: 10
        backup_retention_days: 7
        max_backups_per_day: 2

      instance:
        type: r7g.medium # 8GB RAM - smaller for staging
        databases_per_instance: 10
        max_memory_mb: 7168 # 7GB available (8GB - 1GB OS)
        memory_per_db_mb: 716 # ~700MB per database
        chunk_size: 750
        query_timeout: 30
        max_query_length: 10000
        ingestion_batch_size: 750
        connection_pool_size: 10

      deployment:
        enable_var: LBUG_STANDARD_ENABLED_STAGING
        enabled_default: true
        always_enabled: true

    # =========================================================================
    # LADYBUGDB LARGE TIER - Staging (testing subgraph features)
    # =========================================================================
    - name: ladybug-large
      description: Dedicated r7g.medium with subgraph support for staging (10 subgraphs)
      backend: ladybug
      stack_suffix: LadybugLarge
      tier: ladybug-large

      max_subgraphs: 10
      api_rate_multiplier: 2.5

      copy_operations:
        max_file_size_gb: 2.0
        timeout_seconds: 600
        concurrent_operations: 2
        max_files_per_operation: 200
        daily_copy_operations: 25

      backup_limits:
        max_backup_size_gb: 50
        backup_retention_days: 14
        max_backups_per_day: 5

      instance:
        type: r7g.medium # Smaller for staging
        databases_per_instance: 1
        max_memory_mb: 7168 # 7GB total
        memory_per_db_mb: 650 # ~650MB per database (7GB / 11)
        chunk_size: 1000
        query_timeout: 60
        max_query_length: 25000
        ingestion_batch_size: 1500
        connection_pool_size: 15

      deployment:
        enable_var: LBUG_LARGE_ENABLED_STAGING
        enabled_default: false

    # =========================================================================
    # LADYBUGDB XLARGE TIER - Staging (testing advanced subgraph features)
    # =========================================================================
    - name: ladybug-xlarge
      description: Dedicated r7g.large with maximum subgraph support for staging (25 subgraphs)
      backend: ladybug
      stack_suffix: LadybugXlarge
      tier: ladybug-xlarge

      max_subgraphs: 25
      api_rate_multiplier: 5.0

      copy_operations:
        max_file_size_gb: 5.0
        timeout_seconds: 1800
        concurrent_operations: 3
        max_files_per_operation: 1000
        daily_copy_operations: 100

      backup_limits:
        max_backup_size_gb: 100
        backup_retention_days: 30
        max_backups_per_day: 10

      instance:
        type: r7g.large # Use r7g.large instead of xlarge for staging cost savings
        databases_per_instance: 1
        max_memory_mb: 14336 # 14GB total (16GB - 2GB OS)
        memory_per_db_mb: 550 # ~550MB per database (14GB / 26 databases)
        chunk_size: 1500
        query_timeout: 120
        max_query_length: 50000
        ingestion_batch_size: 3000
        connection_pool_size: 30

      deployment:
        enable_var: LBUG_XLARGE_ENABLED_STAGING
        enabled_default: false

    # =========================================================================
    # LADYBUGDB SHARED TIER - Staging (testing public repositories)
    # =========================================================================
    - name: ladybug-shared
      description: Shared repositories for staging environment (LadybugDB backend)
      backend: ladybug
      stack_suffix: LadybugShared
      tier: ladybug-shared

      shared_repositories: "sec" # Only SEC in staging for testing
      max_subgraphs: null
      api_rate_multiplier: null

      copy_operations:
        max_file_size_gb: 5.0
        timeout_seconds: 1800
        concurrent_operations: 5
        max_files_per_operation: 500
        daily_copy_operations: 100

      backup_limits:
        max_backup_size_gb: 100
        backup_retention_days: 30
        max_backups_per_day: 10

      instance:
        type: r7g.medium # Smaller for staging
        databases_per_instance: 1
        max_memory_mb: 7168
        memory_per_db_mb: 7168
        chunk_size: 2000
        query_timeout: 300
        max_query_length: 100000
        ingestion_batch_size: 5000
        connection_pool_size: 50

      deployment:
        enable_var: LBUG_SHARED_ENABLED_STAGING
        enabled_default: true

    # =========================================================================
    # NEO4J COMMUNITY LARGE TIER - Staging (DISABLED)
    # =========================================================================
    - name: neo4j-community-large
      description: Neo4j Community Edition on r7g.medium for staging (OPTIONAL - disabled)
      backend: neo4j
      stack_suffix: Neo4jCommunityLarge
      tier: neo4j-community-large

      max_subgraphs: 0 # Neo4j Community restricted to 1 database
      api_rate_multiplier: 3.0

      copy_operations:
        max_file_size_gb: 2.0
        timeout_seconds: 600
        concurrent_operations: 2
        max_files_per_operation: 200
        daily_copy_operations: 25

      backup_limits:
        max_backup_size_gb: 50
        backup_retention_days: 14
        max_backups_per_day: 5

      instance:
        type: r7g.medium # Smaller for staging
        databases_per_instance: 1
        neo4j_version: "5.15.0"
        neo4j_edition: "community"
        neo4j_heap_size_mb: 4096 # 4GB heap
        neo4j_page_cache_mb: 2048 # 2GB page cache
        query_timeout: 90
        max_query_length: 50000
        ingestion_batch_size: 2500
        connection_pool_size: 25

      deployment:
        enable_var: NEO4J_COMMUNITY_LARGE_ENABLED_STAGING
        enabled_default: false # DISABLED
        optional: true

    # =========================================================================
    # NEO4J ENTERPRISE XLARGE TIER - Staging (DISABLED)
    # =========================================================================
    - name: neo4j-enterprise-xlarge
      description: Neo4j Enterprise Edition on r7g.large for staging (OPTIONAL - disabled)
      backend: neo4j
      stack_suffix: Neo4jEnterpriseXlarge
      tier: neo4j-enterprise-xlarge

      max_subgraphs: 25
      api_rate_multiplier: 6.0

      copy_operations:
        max_file_size_gb: 5.0
        timeout_seconds: 1800
        concurrent_operations: 5
        max_files_per_operation: 500
        daily_copy_operations: 100

      backup_limits:
        max_backup_size_gb: 100
        backup_retention_days: 30
        max_backups_per_day: 10

      instance:
        type: r7g.large # Medium-large for staging testing
        databases_per_instance: 1
        neo4j_version: "5.15.0"
        neo4j_edition: "enterprise"
        neo4j_heap_size_mb: 8192 # 8GB heap
        neo4j_page_cache_mb: 4096 # 4GB page cache
        neo4j_clustering: false # No clustering in staging
        query_timeout: 180
        max_query_length: 100000
        ingestion_batch_size: 5000
        connection_pool_size: 50

      deployment:
        enable_var: NEO4J_ENTERPRISE_XLARGE_ENABLED_STAGING
        enabled_default: false # DISABLED
        optional: true

# =============================================================================
# DEVELOPMENT ENVIRONMENT
# =============================================================================
development:
  writers:
    # =========================================================================
    # LADYBUGDB STANDARD TIER - Development (subgraphs enabled for testing)
    # =========================================================================
    - name: ladybug-standard
      description: LadybugDB standard tier for local development with subgraph support
      backend: ladybug
      stack_suffix: LadybugDev
      tier: ladybug-standard

      max_subgraphs: 2
      api_rate_multiplier: 1.0

      copy_operations:
        max_file_size_gb: 1.0
        timeout_seconds: 300
        concurrent_operations: 1
        max_files_per_operation: 100
        daily_copy_operations: 10

      backup_limits:
        max_backup_size_gb: 10
        backup_retention_days: 7
        max_backups_per_day: 2

      instance:
        type: r7g.medium
        databases_per_instance: 10
        max_memory_mb: 7168
        memory_per_db_mb: 716
        chunk_size: 750
        query_timeout: 30
        max_query_length: 10000
        ingestion_batch_size: 750
        connection_pool_size: 10

      deployment:
        always_enabled: true
        enabled_default: true
