# Dagster configuration for RoboSystems
# This file configures Dagster's storage backends and execution settings.

# Run storage - stores run metadata
run_storage:
  module: dagster_postgres.run_storage
  class: PostgresRunStorage
  config:
    postgres_db:
      hostname:
        env: DAGSTER_POSTGRES_HOST
      port:
        env: DAGSTER_POSTGRES_PORT
      username:
        env: DAGSTER_POSTGRES_USER
      password:
        env: DAGSTER_POSTGRES_PASSWORD
      db_name:
        env: DAGSTER_POSTGRES_DB

# Event log storage - stores structured event logs for runs
event_log_storage:
  module: dagster_postgres.event_log
  class: PostgresEventLogStorage
  config:
    postgres_db:
      hostname:
        env: DAGSTER_POSTGRES_HOST
      port:
        env: DAGSTER_POSTGRES_PORT
      username:
        env: DAGSTER_POSTGRES_USER
      password:
        env: DAGSTER_POSTGRES_PASSWORD
      db_name:
        env: DAGSTER_POSTGRES_DB

# Schedule storage - stores schedule and sensor state
schedule_storage:
  module: dagster_postgres.schedule_storage
  class: PostgresScheduleStorage
  config:
    postgres_db:
      hostname:
        env: DAGSTER_POSTGRES_HOST
      port:
        env: DAGSTER_POSTGRES_PORT
      username:
        env: DAGSTER_POSTGRES_USER
      password:
        env: DAGSTER_POSTGRES_PASSWORD
      db_name:
        env: DAGSTER_POSTGRES_DB

# Run launcher - how runs are executed
# Using default in-process launcher for local development
# Production uses EcsRunLauncher (see dagster_prod.yaml)
run_launcher:
  module: dagster.core.launcher
  class: DefaultRunLauncher

# Run coordinator - balanced parallel execution for local dev
# Note: too high concurrency (>5 workers) can overwhelm the code server
run_coordinator:
  module: dagster.core.run_coordinator
  class: QueuedRunCoordinator
  config:
    dequeue_interval_seconds: 1
    max_concurrent_runs: 10
    dequeue_use_threads: true
    dequeue_num_workers: 4

# Telemetry - disable for privacy
telemetry:
  enabled: false
